
@{
    ViewBag.Title = "KPMG Intern | Perdiem / Transport";
    Layout = "~/Views/Shared/_TPJMaster.cshtml";
}
<div class="breadcrumb-container">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><i class="fa fa-home pr-2"></i>Profile</li>
            <li class="breadcrumb-item active">Perdiem / Transport</li>
        </ol>
    </div>
</div>
<div id="page-start"></div>
<!-- section end -->
<!-- section -->
<!-- ================ -->
<div class="main-container  light-translucent-bg background-img-7">
    <div class="container ">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fa fa-list-alt pr-10"></i>Perdiem / Transport

                        </h4>

                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12 text-right">
                                <a id="addInternShip" href="#" onclick="$('#PopupAdd').modal(); $('#foredit').hide(); $('#foradd').show(); foraddbutton();" class="btn btn-animated btn-success">Add Perdiem / Transport <i class="fa fa-plus"></i></a>
                            </div>
                        </div>



                        <div class="row">
                            <div class="col-md-12">
                                <ul class="nav nav-tabs style-3" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#h3tab2" role="tab" data-toggle="tab">
                                            <h4 style="color: rgb(60, 141, 188);"><span class="fa fa-exclamation-triangle"></span>&nbsp; Additional notes</h4>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link " href="#h3tab1" role="tab" data-toggle="tab">
                                            <h4 style="color: rgb(60, 141, 188);"><span class="fa fa-list"></span>&nbsp; Perdiem / Transport</h4>
                                        </a>
                                    </li>

                                </ul>
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div class="tab-pane show" role="tabpanel" id="h3tab1">
                                        <div class="row">
                                            <div class="col-md-12">

                                                <button id="btnOK" type="button" onclick="AddData('S')" class="btn btn-primary pull-right" data-dismiss="modal">
                                                    <span class="fa fa-check-circle-o"></span>&nbsp; Submit
                                                </button>

                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-bordered" id="gvwData" width="100%">
                                                        <thead>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane show active" role="tabpanel" id="h3tab2">
                                        <div>
                                            <p><strong><u>Transportation Expenses and arrangements</u></strong></p>
                                            <p>Staff members can reimburse the difference of kilometers between home to office and home to clients&rsquo; premise where home to clients&rsquo; premise is greater than to office.</p>
                                            <ul>
                                                <li>The reimbursable rate regardless of transportation mode will be at the rate of 8.00 Baht per kilometer.</li>
                                                <li>Taxi fare is reimbursable for the trip of job opening or closing only.</li>
                                                <li>Where an urgent assignment needs to be undertaken and the working period goes beyond 9:00 p.m., the taxi fares are reimbursable.</li>
                                            </ul>
                                            <p><strong><u>Per Diem Allowance</u></strong></p>
                                            <ul>
                                                <li>
                                                    Per Diem allowances of Baht 80 per day will be granted to all staff levels
                                                    <ul>
                                                        <li>For a day trip assignment outside Greater Bangkok/ Out of Boundary area and up-country.</li>
                                                        <li>For an overnight stay in upcountry, where clients provide meals for staff.</li>
                                                    </ul>
                                                </li>
                                                <li>Per Diem allowances include meals and other incidental expenses.</li>
                                                <li>From 1 January 2020 onwards, Per Diem allowances of Baht 350 per night will be reimbursed to all staff levels for upcountry/out of town assignments that requires an overnight stay, on the date of travelling back, staff will be reimbursed of Baht 80.</li>
                                            </ul>
                                            <p>&nbsp;</p>
                                            <p><strong>Outside Greater Bangkok/ Out of Boundary area will be defined as the area beyond the following area</strong></p>
                                            <ul>
                                                <li><strong>Eastern</strong> - Bangna - Trad Km.9, Wat Sa Lut</li>
                                                <li><strong>North Eastern</strong> - Beyond Eastern Outer Ring Road (Kannayao)</li>
                                                <li><strong>North</strong> - Future Park Rangsit</li>
                                                <li><strong>North Western</strong> - Beyond Thanon 345</li>
                                                <li><strong>Western</strong> - Phuttamonthon Sai 4, Salaya</li>
                                                <li><strong>Southern</strong> - Rama II, Beyond Southern Outer Ring Road (Kanchanapisek)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer text-center">


                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="PopupAdd" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #337ab7;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span class="modal-title">
                    <b style="color: white;">
                        <span class="fa fa-plus-circle"></span>&nbsp; Perdiem / Transport
                    </b>
                </span>
            </div>
            <div class="modal-body text-center">

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">Type of reimbursement </label>
                            <div class="col-sm-5">
                                <select class="form-control input-sm" id="ddlType_of_reimbursement">
                                    <option value="P">Perdiem</option>
                                    <option value="T">Transport</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">Company </label>
                            <div class="col-sm-5">
                                <select class="form-control input-sm" id="ddlCompany">
                                    <option value="1">KPMG Phoomchai Audit Ltd.</option>
                                    <option value="2">KPMG Phoomchai Tax Ltd.</option>
                                    <option value="3">KPMG Phoomchai Business Advisory Ltd.</option>
                                    <option value="4">KPMG Phoomchai Holdings Co., Ltd.</option>
                                    <option value="5">KPMG Consulting (Thailand) Limited</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">Reimbursable  </label>
                            <div class="col-sm-5">
                                <select class="form-control input-sm" id="ddlReimbursable">
                                    <option value="C">Client </option>
                                    <option value="O">Office</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Business Purpose
                            </label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control input-sm" id="txtBusiness_Purpose" name="txtBusiness_Purpose" maxlength="200" value="@Model.Business_Purpose">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Date <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control input-sm" id="txtdaterange" name="txtdaterange" maxlength="200" value="@Model.daterange" autocomplete="off">
                            </div> <div class="col-sm-2">
                                <input type="text" class="form-control input-sm" id="sumdate" name="sumdate" maxlength="200" value="" hidden>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" style="display:none;">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Description
                            </label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control input-sm" id="txtDescription" name="txtDescription" maxlength="200" value="@Model.Description">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Amount <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-5">
                                <input type="number" class="form-control input-sm" id="txtAmount" name="txtAmount" maxlength="200" value="@Model.Amount">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Engagement Code <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-5">
                                <input id="txtEngagement_Code" name="txtEngagement_Code" class="form-control" type="search" list="engagement_lst" value="@Model.Engagement_Code" onchange="setvaltolabel(this);" />

                                <datalist id="engagement_lst"></datalist>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group form-group-sm row">
                            <label class="col-sm-4 col-form-label nomallabel text-right">
                                Approved by <span class="text-danger">*</span>
                            </label>
                            <div class="col-sm-5" style="border:1px solid gray;padding: 10px;
    border-radius: 10px;">

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group form-group-sm row">
                                            <label class="col-sm-4 col-form-label nomallabel text-right">Name</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-sm" id="txtNameMG" name="txtNameMG" value="@Model.mgr_user_name" disabled>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group form-group-sm row">
                                            <label class="col-sm-4 col-form-label nomallabel text-right">Name / ID</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-sm " style="display:none;" id="txtMGID" name="txtMGID" value="@Model.mgr_user_no" disabled>
                                                <input type="text" class="form-control input-sm" id="txtSearchMG" name="txtSearchMG" value="@Model.mgr_user_no"
                                                       @Html.Raw(HttpUtility.HtmlDecode(Model.status + "" == "Y" ? "disabled" : ""))>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group form-group-sm row">
                                            <label class="col-sm-4 col-form-label nomallabel text-right">Group</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-sm" id="txtgroupMG" name="txtgroupMG" value="@Model.mgr_unit_name" disabled>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group form-group-sm row">
                                            <label class="col-sm-4 col-form-label nomallabel text-right">Rank</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control input-sm" id="txtpositionMG" name="txtpositionMG" value="@Model.mgr_user_rank" disabled>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <div id="foradd">
                    <button id="btnOK" type="button" onclick="AddData('A')" class="btn btn-primary" data-dismiss="modal">
                        <span class="fa fa-plus-circle"></span>&nbsp; Add
                    </button>
                    @*<button type="button" class="btn btn-danger" data-dismiss="modal"><span class="fa fa-times-circle"></span>&nbsp; Cancel</button>*@
                </div>
                <div id="foredit">
                    <button id="btnOK" type="button" onclick="AddData('U')" class="btn btn-primary" data-dismiss="modal">
                        <span class="fa fa-edit"></span>&nbsp; Update
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmCancle()"><span class="fa fa-times-circle"></span>&nbsp; Withdraw</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section style{
    <link href="~/Scripts/plugins/dist/css/AdminLTE.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/dist/css/skins/_all-skins.min.css" rel="stylesheet" />

    <link href="~/Scripts/plugins/DateTimePicker_Cus/dist/DateTimePicker.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />



}



@section scripts{
    @*<script src="~/Scripts/plugins/jquery/dist/jquery.min.js"></script>
        <script src="~/Scripts/plugins/jquery-ui/jquery-ui.min.js"></script>*@
    <script src="~/Scripts/plugins/knockout-3.4.2.js"></script>
    <script src="~/Scripts/plugins/knockout.mapping-latest.js"></script>

    <!-- Slimscroll -->
    <script src="~/Scripts/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="~/Scripts/plugins/fastclick/lib/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="~/Scripts/plugins/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/Scripts/plugins/dist/js/demo.js"></script>
    <!-- fullCalendar -->
    <script src="~/Scripts/plugins/moment/moment.js"></script>

    <script src="~/Scripts/plugins/DateTimePicker_Cus/dist/DateTimePicker.min.js"></script>
    <script src="~/Scripts/plugins/DateTimePicker_Cus/src/i18n/DateTimePicker-i18n.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script>
        var objModel = @Html.Raw(Json.Encode(Model));
        var lstforEven = "";
        var STAddEven;
        var EDAddEven;

        var objEven = [];
        var dstart;
        var dend;
        $(function () {
        $.ajax({
                dataType: AjaxCall.dataType,
                type: AjaxCall.type,
                contentType: AjaxCall.contentType,
                url:'@Url.Action("GetEngagement", "PerdiemTransport")',
                data: JSON.stringify({ ItemData : "" }),
                    success: function (respone) {

                        var str = ''; // variable to store the options
                        var newdata = new Array(respone);
                        for (var i = 0; i < newdata[0].length; ++i) {
                            str += '<option title="' + newdata[0][i].value+'" id="' + newdata[0][i].id + '" value="' + newdata[0][i].id + '"  >'+ newdata[0][i].text +'</option>'; // Storing options in variable
                        }
                        var my_list = document.getElementById("engagement_lst");
                        my_list.innerHTML = str;
                        getall = newdata;
                },
                error: AjaxCall.error,
                complete: function (jqXHR, status) {//finaly
                    UnblockUI();

                }
            });
            SetActiveMenu("perxtran");
            SetTable();
            BindData(objModel);
            ko.applyBindings(viewModel);

            if (objModel.lstData.length > 0) {
                $('#gvwData').DataTable().clear().draw();
                $('#gvwData').dataTable().fnAddData(objModel.lstData);
                $('#gvwData').dataTable().fnDraw();
            }
            $('input[name="txtdaterange"]').daterangepicker({
                opens: 'left',
                locale: {
                    format: 'DD/MM/YYYY'
                }
            }, function (start, end, label) {

                dstart = start.format('YYYY-MM-DD');
                dend = end.format('YYYY-MM-DD');

                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
            });



            if (GetInputByID("txtSearchMG") != undefined || GetInputByID("txtSearchMG") != "") {
                SetAutocomMGR("txtSearchMG");
            }

            $("#sumdate").val('1 (day)');

        })
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            if (e.target.hash == '#h3tab1') {
                $('#gvwData').DataTable().columns.adjust().draw();
            }

        });
        var map_approve;
        var getall;
        $("#txtEngagement_Code").blur(function () {
            for (var item in getall) {
                for (var items in getall[item]) {
                    if (getall[item][items].id === $("#txtEngagement_Code").val())
                    {
                        map_approve = getall[item][items].value;
                    }
                }
            }
            $('#txtSearchMG').val(map_approve);
            var valget = [];
                    $.ajax({
                    dataType: AjaxCall.dataType,
                        type: AjaxCall.type,
                        async: false,
                    contentType: AjaxCall.contentType,
                     url: '@Url.Action("UserAutoCompleteAmUp", "TraineeMasterData")',
                    data: JSON.stringify({ SearchItem: map_approve }),
                        success: function (data) {
                            valget = data;
                        }
                });
            ClearMGR(valget[0].user_name, valget[0].unit_name, valget[0].user_rank, valget[0].user_no);
        });

        //$("#txtdaterange,#ddlType_of_reimbursement").change(function () {
        //    var gettype = $("#ddlType_of_reimbursement").val();

        //    if (gettype == 'P') {
        //        //$('#txtAmount').attr('readonly', true);
        //        dstart = new Date(dstart);
        //        dend = new Date(dend);
        //        var days = (dend - dstart) / (1000 * 60 * 60 * 24);
        //        days = days + 1;
        //        $("#sumdate").val(days+' (day)');
        //        if (days > 1) {
        //            var getforcal = days - 1;
        //            var calset = getforcal * 250;
        //            var sumall = calset + 80;
        //            //$("#txtAmount").val(sumall);
        //        }
        //        else {
        //            //$("#txtAmount").val('80');
        //        }
        //    } else {
        //        //$('#txtAmount').attr('readonly', false);
        //        $("#txtAmount").val('0');
        //    }
        //});



        function SetTable() {
            var objHeadClRequest = [
                { "title": "Edit", "width": "5%", "className": "dt-center-ctm", "data": "Edit" },
                { "title": "Type of withdrawal", "width": "8%", "className": "dt-center-ctm", "data": "Type_of_withdrawal" },
                { "title": "Company ", "width": "20%", "className": "dt-center-ctm", "data": "Company" },
                { "title": "Date  Period", "width": "18%", "className": "dt-center-ctm", "data": "daterange" },
                { "title": "Amount ", "width": "3%", "className": "dt-right-ctm", "data": "Amount" },
                { "title": "Charge Code", "width": "20%", "className": "dt-left-ctm", "data": "Engagement_Code" },
                { "title": "Approved by", "width": "15%", "className": "dt-left-ctm", "data": "Approve_user" },
                { "title": "Status", "width": "10%", "className": "dt-left-ctm", "data": "approve_status" },
            ];

            var objTableRe = {
                sTableID: "gvwData",
                nDis: [],
                sProperty: "<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",//length pangging
                objHeadCl: objHeadClRequest,//Table Headder
                objDataSet: [], //dataset
                nHeadFix: 0,// fix clr
                EmptyTable: EmptyTable,
                order: [[7, "asc"]],
                objBeforeClRender: false,
                //fixedHeader: {
                //    header: true,
                //},
                columnDefs: [
                    //{
                    //    //"render": function (data, type, row, meta) {
                    //    //    return meta.row + meta.settings._iDisplayStart + 1;
                    //    //},
                    //
                    //    "targets": 1
                    //},
                    {

                        "render": function (data, type, row) {
                            return data == "P" ? "Perdiem" : "Transport";
                        },
                        "targets": 1
                    },
                    {

                        "render": $.fn.dataTable.render.number(',', '.', 2),
                        "targets": 4
                    },
                    {
                        "visible": false,
                        "render": function (data, type, row) {
                            var datas = "";
                            switch (data) {
                                case "1":
                                    datas = "KPMG Phoomchai Audit Ltd.";
                                    break;
                                case "2":
                                    datas = "KPMG Phoomchai Tax Ltd.";
                                    break;
                                case "3":
                                    datas = "KPMG Phoomchai Business Advisory Ltd.";
                                    break;
                                case "4":
                                    datas = "KPMG Phoomchai Holdings Co., Ltd.";
                                    break;
                                case "5":
                                    datas = "KPMG Consulting (Thailand) Limited";
                                    break;

                                default:
                            }
                            return datas;
                        },
                        "targets": 2
                    },
                    {
                        "render": function (data, type, row) {
                            var datas = "";
                            switch (data) {
                                case "Y":
                                    datas = "<span class='fa fa-circle' style='color:#009192;'></span>&nbsp; Approved";
                                    break;
                                case "N":
                                    datas = "<span class='fa fa-circle' style='color:#007092;'></span>&nbsp; Submited";
                                    break;
                                case "C":
                                    datas = "<span class='fa fa-circle' style='color:#924300;'></span>&nbsp; Withdrawn";
                                    break;
                                case "R":
                                    datas = "<span class='fa fa-circle' style='color:#920000;'></span>&nbsp; Revise";
                                    break;
                                case "D":
                                    datas = "<span class='fa fa-circle' style='color:#008b92;'></span>&nbsp; Draft";
                                    break;
                                case "A":
                                    datas = "<span class='fa fa-circle' style='color:#6e0092;'></span>&nbsp; Awaiting Paid";
                                    break;
                                case "P":
                                    datas = "<span class='fa fa-circle' style='color:#1d9200;'></span>&nbsp; Paid";
                                    break;

                                default:
                            }
                            return datas;

                            return data == "Y" ? "<span class='fa fa-circle text-success'></span>&nbsp; Approved" : "<span class='fa fa-circle text-warning'></span>&nbsp; Waiting";
                        },
                        "targets": 7
                    }]
            };
            var table = CreatTableJS(objTableRe);
            //new $.fn.dataTable.FixedHeader($('#gvwData'));
        }
        function ClearMGR(vName, vGroup, vPosition, vID) {
            GetInputByID("txtNameMG").val(vName);
            GetInputByID("txtgroupMG").val(vGroup);
            GetInputByID("txtpositionMG").val(vPosition);
            GetInputByID("txtMGID").val(vID);
        }
         function SetAutocomMGR(txtTarget) {
            $("input[id$=" + txtTarget + "]").on("keyup", function () {
                            ClearMGR("", "", "", "");
            });


            $("input[id$=" + txtTarget + "]").autocomplete({
                            //disabled: true,
                open: function () {
                    setTimeout(function () {
                        $('.ui-autocomplete').css('z-index', 99999999999999);
                    }, 0);
                },
                            source: function (request, response) {
                                $.ajax({
                                    dataType: AjaxCall.dataType,
                                    type: AjaxCall.type,
                                    contentType: AjaxCall.contentType,
                                    url: '@Url.Action("UserAutoCompleteAmUp", "TraineeMasterData")',
                        data: JSON.stringify({ SearchItem: request.term }),
                        success: function (data) {
                            UnblockUI();
                            response($.map(data, function (item) {
                                return {
                                    value: item.id,
                                    label: item.id + " : " + item.user_name ,
                                    user_id: item.user_id,
                                    user_no: item.id,
                                    user_name: item.user_name,
                                    unit_name: item.unit_name,
                                    user_rank: item.user_rank,
                                }
                            }));
                        }
                    });
                },
                        minLength: 1,
                        select: function (event, ui) {
                            ClearMGR(ui.item.user_name, ui.item.unit_name, ui.item.user_rank, ui.item.user_no);
                },


                        });
        }

        function confirmCancle()
        {
            DialogConfirm("Cancle", "Do you want to cancel this step?", function () {


                $.ajax({
                    dataType: AjaxCall.dataType,
                    type: AjaxCall.type,
                    async: false,
                    contentType: AjaxCall.contentType,
                    url: '@Url.Action("Update_Cancle", "PerdiemTransport")',
                    data: JSON.stringify({ Id: objModel.Id }),
                    success: function (respone) {
                        if (respone.result.Status == SysProcess.SessionExpired) {
                            PopupLogin('@Url.Action("Index", "Home")');
                        } else if (respone.result.Status == SysProcess.Success) {
                            DialogSuccessOk(DialogHeader.Info, respone.result.Msg, 'func', function () {

                                window.location.reload(true);
                            });
                        }
                        else if (respone.result.Status == SysProcess.Duplicate) {
                            DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                        else {
                            DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                        UnblockUI();
                    },
                    error: AjaxCall.error,
                    complete: function (jqXHR, status) {//finaly
                        UnblockUI();
                    }
                })
            }, function () {


            });
        }

        function setapprove(val)
        {
            $.ajax({
                dataType: AjaxCall.dataType,
                type: AjaxCall.type,
                contentType: AjaxCall.contentType,
                url:'@Url.Action("GetEngagement", "PerdiemTransport")',
                data: JSON.stringify({ ItemData : "" }),
                    success: function (respone) {

                        var str = ''; // variable to store the options
                        var newdata = new Array(respone);
                        for (var i = 0; i < newdata[0].length; ++i) {
                            str += '<option id="' + newdata[0][i].id + '" value="' + newdata[0][i].id + '" >'+ newdata[0][i].text +'</option>'; // Storing options in variable
                        }
                        var my_list = document.getElementById("engagement_lst");
                        my_list.innerHTML = str;


                },
                error: AjaxCall.error,
                complete: function (jqXHR, status) {//finaly
                    UnblockUI();

                }
            });
        }
        function foraddbutton() {
            setUnReadonly();

            $("#ddlType_of_reimbursement").val("P");
            $("#ddlCompany").val("1");
            $("#ddlReimbursable").val("C");
            $('#txtAmount').val("");
            $('#txtBusiness_Purpose').val("");
            $('#txtdaterange').val("");
            $('#txtEngagement_Code').val("");
            $('#txtDescription').val("");
            $("#sumdate").val("");

            $('#txtSearchMG').val("");
            $('#txtNameMG').val("");
            $('#txtgroupMG').val("");
            $('#txtpositionMG').val("");
            $('#txtMGID').val("");
        }
        function setReadonly()
        {
            $("#ddlType_of_reimbursement").attr("readonly", "readonly");
            $("#ddlCompany").attr("readonly", "readonly");
            $("#ddlReimbursable").attr("readonly", "readonly");
            $('#txtAmount').prop('readonly', true);
            $('#txtBusiness_Purpose').prop('readonly', true);
            $('#txtdaterange').prop('readonly', true);
            $('#txtEngagement_Code').prop('readonly', true);
            $('#txtDescription').prop('readonly', true);

            $('#sumdate').prop('readonly', true);
            $('#txtSearchMG').prop('readonly', true);
        }

        function setUnReadonly() {
            $("#ddlType_of_reimbursement").attr("readonly", false);
            $("#ddlCompany").attr("readonly", false);
            $("#ddlReimbursable").attr("readonly", false);
            $('#txtAmount').prop('readonly', false);
            $('#txtBusiness_Purpose').prop('readonly', false);
            $('#txtdaterange').prop('readonly', false);
            $('#txtEngagement_Code').prop('readonly', false);
            $('#txtDescription').prop('readonly', false);

            $('#sumdate').prop('readonly', false);
            $('#txtSearchMG').prop('readonly', false);
        }
        function GetData() {


            var lstData = ko.toJS(viewModel);
            lstData.Id = objModel.Id;
            lstData.Type_of_withdrawal = GetValDropdown("ddlType_of_reimbursement");
            lstData.Company = GetValDropdown("ddlCompany");
            lstData.Reimbursable = GetValDropdown("ddlReimbursable");
            lstData.Business_Purpose = GetValTextBox("txtBusiness_Purpose");
            lstData.Description = GetValTextBox("txtDescription");
            if(lstData.Amount == ""){ DialogWarning(DialogHeader.Warning, "Please input Amount");}
            else{lstData.Amount = GetValTextBox("txtAmount");}
            if(lstData.daterange == ""){ DialogWarning(DialogHeader.Warning, "Please input Date");}
            else{lstData.daterange = GetValTextBox("txtdaterange");}
            if(lstData.Engagement_Code == ""){ DialogWarning(DialogHeader.Warning, "Please input Engagement Code");}
            else{ lstData.Engagement_Code = GetValTextBox("txtEngagement_Code");}
            if(lstData.mgr_user_no == ""){ DialogWarning(DialogHeader.Warning, "Please input Approved by");}
            else{ lstData.mgr_user_no = GetValTextBox("txtSearchMG");}




            return lstData;
        }

        function setvaltolabel(val)
        {
            $('engagement_name').text(val.text);
        }
        function EditData(id)
        {
            $('#PopupAdd').modal();
            $("#foradd").hide();
            $("#foredit").show();
            foraddbutton();

            var newdata = [];
            $.each(objModel.lstData, function (key, value) {
                if (value.Id == id)
                {
                    newdata = value;
                }
                //alert(key + ": " + value.Id);
            });

            if (newdata.length != 0)
                objModel.Id = newdata.Id;
            objModel.Amount = newdata.Amount;
            objModel.Description = newdata.Description;

            if (newdata.approve_status == "Y") {
                $("#foradd").hide();
                $("#foredit").hide();

                setReadonly();

            }
            else
            {
                setUnReadonly();
            }
            $("#ddlType_of_reimbursement").val(newdata.Type_of_withdrawal);
            $("#ddlCompany").val(newdata.Company);
            $("#ddlReimbursable").val(newdata.Reimbursable);
            $('#txtAmount').val(newdata.Amount);
            $('#txtBusiness_Purpose').val(newdata.Business_Purpose);
            $('#txtdaterange').val(newdata.date_start + ' - '+newdata.date_end);
            $('#txtEngagement_Code').val(newdata.Engagement_Code.split("|")[0]);
            $('#txtDescription').val(newdata.Description);

            var std = moment(newdata.date_start).format('DD-MM-YYYY');
            var st = new Date(newdata.date_start);
            var ed = new Date(newdata.date_end);
            var days = (ed- st) / (1000 * 60 * 60 * 24);
            days = days + 1;
            $("#sumdate").val(days + ' (day)');

            map_approve = newdata.mgr_user_no;

            //for (var item in getall) {
            //    for (var items in getall[item]) {
            //        if (getall[item][items].id === $("#txtEngagement_Code").val())
            //        {
            //            map_approve = getall[item][items].value;
            //        }
            //    }
            //}
            $('#txtSearchMG').val(map_approve);
            var valget = [];
                    $.ajax({
                    dataType: AjaxCall.dataType,
                        type: AjaxCall.type,
                        async: false,
                    contentType: AjaxCall.contentType,
                     url: '@Url.Action("UserAutoCompleteAmUp", "TraineeMasterData")',
                    data: JSON.stringify({ SearchItem: map_approve }),
                        success: function (data) {
                            valget = data;
                        }
            });
            if (valget.length>0)
            ClearMGR(valget[0].user_name, valget[0].unit_name, valget[0].user_rank, valget[0].user_no);
            //ko.mapping.fromJS(objModel, {}, viewModel);
            //BindData(objModel);
            //ko.applyBindings(viewModel);
        }


         function AddData(type)
         {


             BlockUI();
             if (type == 'A') {
                 objModel.Id = 0;
                 BindData(objModel);
             }
            var Param = GetData();
            //if (type == 'Draft') { }
             $.ajax({
                dataType: AjaxCall.dataType,
                type: AjaxCall.type,
                async: false,
                contentType: AjaxCall.contentType,
                 url: '@Url.Action("SavePerdiem_Transport", "PerdiemTransport")',
                 data: JSON.stringify({ ItemData : Param,TypeSave : type}),
                success: function (respone) {
                     if (respone.result.Status == SysProcess.SessionExpired) {
                             PopupLogin('@Url.Action("Index", "Home")');
                        } else if (respone.result.Status == SysProcess.Success) {
                         DialogSuccessOk(DialogHeader.Info, DialogMsg.SaveComplete, 'func', function () {

                             var data = respone.result.lstData;

                             //$('#gvwData').DataTable().clear().draw();
                             //$('#gvwData').dataTable().fnAddData(data);
                             //$('#gvwData').dataTable().fnDraw();
                                 window.location.reload(true);
                            });
                        }
                        else if (respone.result.Status == SysProcess.Duplicate) {
                            DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                        else {
                            DialogWarning(DialogHeader.Warning, respone.result.Msg);
                    }
                    UnblockUI();
                },
                error: AjaxCall.error,
                complete: function (jqXHR, status) {//finaly
                    UnblockUI();
                }
             });
        }

    </script>

    @*Script for bind Data KnockOut*@
    <script type="text/javascript">
        var viewModel = {

        };
        function ViewModel() {
            var self = this;
            self.conditionChecked = ko.observable(false);
            self.loadCondition = function () {
                //ajax request to get condition value. Suppose ajax request returned value "used". so
                self.conditionChecked("used");
            }
            self.loadCondition();
            ko.bindingHandlers.iCheck = { // integrating icheck plugin using bh

                init: function (element, valueAccessor) {
                    var ctrl = $(element);
                    var sID = ctrl[0].id;
                    //initialize icheck to the element
                    $(element).iCheck({
                        radioClass: 'iradio_flat-green'
                    });
                    $(element).on('ifChecked', function (event) {

                        var observable = valueAccessor();
                        observable.checked(event.target.defaultValue); //assigning selected value

                    });

                },
                update: function (element, valueAccessor) {
                    var observable = valueAccessor();
                }
            };
        }
        function BindData(value) {
            if (viewModel == undefined) {
                viewModel = ko.mapping.fromJS(value);
                ViewModel();

            }
            else {
                ko.mapping.fromJS(value, {}, viewModel);

            }
        }

    </script>

}