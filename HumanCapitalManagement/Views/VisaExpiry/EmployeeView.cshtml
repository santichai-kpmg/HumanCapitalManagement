@{
    /**/

    ViewBag.Title = "Visa Expiry | Company Information";
    Layout = "~/Views/Shared/_LPMaster.cshtml";
}

<section class="content-header">
    @if (string.IsNullOrEmpty(Model.Member))
    {
        <h1>
            Visa Expiry | Employee
        </h1>

    }
    else
    {
        <h1>
            Visa Expiry | Member
        </h1>
    }


</section>

<section class="content">
    <form class="form-horizontal">
        <div id="divContent">
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- Student detail -->
                            <div class="box box-solid box-ctmPR">
                                <div class="box-header with-border">
                                    <h3 class="box-title">
                                        Information
                                    </h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- /.box-header -->
                                <!-- form start -->
                                <div class="box-body">
                                    <div class="row">
                                        @if (string.IsNullOrEmpty(Model.Member))
                                        {
                                            <div class="col-md-6">
                                                <div class="form-group form-group-sm">
                                                    <label class="col-md-4 control-label text-right nomallabel">Company</label>
                                                    <div class="col-md-8">

                                                        <input type="text" id="txtcompany" name="txtcompany" class="form-control" data-bind='value: Company_name' disabled />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group form-group-sm">
                                                    <label class="col-md-4 control-label text-right nomallabel">Employee Id</label>
                                                    <div class="col-md-8">

                                                        <input type="text" id="txtcodecus" name="txtcodecus" class="form-control" data-bind='value: code' disabled />
                                                    </div>
                                                </div>
                                            </div>

                                        }
                                        else
                                        {

                                        }
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Prefix</label>
                                                <div class="col-md-6">
                                                    @{ Html.RenderAction("Createddl_VisaPrefixEN", "HCMMasterData", new
                                                        {
                                                            id = "ddlPrefix",
                                                            databind = "TM_Prefix_Id",
                                                            value = "",
                                                            disable = true
                                                        });}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Name (ENG)</label>
                                                <div class="col-md-8">

                                                    <input type="text" id="txtNameENG" name="txtNameENG" class="form-control" data-bind='value: name_eng' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Last Name (ENG)</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txtlastnameENG" name="txtlastnameENG" class="form-control" data-bind='value: lastname_eng' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Middle Name</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txtmiddle" name="txtmiddle" class="form-control" data-bind='value: middle' disabled />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Name (TH)</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txtNameTH" name="txtNameTH" class="form-control" data-bind='value: name_th' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Last Name (TH)</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txtlastnameTH" name="txtlastnameTH" class="form-control" data-bind='value: lastname_th' disabled />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">E-mail</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txtemail" name="txtemail" class="form-control" data-bind='value: mail' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Telephone</label>
                                                <div class="col-md-8">
                                                    <input type="text" id="txttelephone" name="txttelephone" class="form-control" data-bind='value: telephone' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Create Date</label>
                                                <div class="col-md-8">
                                                    <input type="text" class="form-control" data-bind='value: create_date' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">Update Date</label>
                                                <div class="col-md-8">
                                                    <input type="text" class="form-control" data-bind='value: update_date' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right nomallabel">HR Coordinator</label>
                                                <div class="col-md-8">
                                                    <input type="text" class="form-control" data-bind='value: staff' disabled />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group form-group-sm">
                                                <label class="col-md-4 control-label text-right">Remark</label>
                                                <div class="col-md-8">
                                                    <div class="input-group">
                                                        @{ Html.RenderAction("Createddl_VisaRemark", "HCMMasterData", new
                                                            {
                                                                id = "ddlRemark",
                                                                databind = "remark",
                                                                value = "",
                                                                disable = true
                                                            });}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="box-footer text-right">
                                            <button type="button" id="btnEditEmp" class="btn btn-primary" onclick="EditEmp(objModel.IdEncrypt);">Edit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- /.box-header -->
                            <!-- form start -->
                            <div class="box-body ">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="nav-tabs-custom">
                                            <ul class="nav nav-tabs">
                                                <li class="active"><a href="#tab_1" data-toggle="tab">Document Employee </a></li>
                                                <li class=""><a href="#tab_2" data-toggle="tab">Family Member</a></li>
                                            </ul>
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab_1">
                                                    <div class="box-body">
                                                        <div class="col-md-4">
                                                            <div class="form-group form-group-sm">
                                                                <label class="col-md-3 control-label text-right nomallabel">Status</label>
                                                                <label class="col-md-8">
                                                                    <input type="radio" name="Status" id="rdlStatus" checked class="flat-green radio radio-inline" data-bind='iCheck: { checked: active_status}' value="Y">Active &nbsp;
                                                                    <input type="radio" name="Status" id="rdlStatus" class="flat-green radio radio-inline" data-bind='iCheck: { checked: active_status}' value="N">Inactive
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="text-right">
                                                            <button type="button" id="btnSearch" class="btn btn-primary" onclick="LoadData();">Search</button>
                                                            <button type="button" id="btnEdit" class="btn btn-success" onclick="AddDocument();">Add Document</button>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="box-body">
                                                                <div class="row ">
                                                                    <div class="col-md-12">
                                                                        <div class="table-responsive">
                                                                            <table class="table table-striped table-bordered table-hover display" id="gvwDataDoc" width="100%">
                                                                                <thead>
                                                                                </thead>
                                                                                <tbody></tbody>
                                                                            </table>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="tab-pane" id="tab_2">
                                                    <div class="box-body">
                                                        <div class="col-md-4">
                                                            @*<div class="form-group form-group-sm">
                                                                    <label class="col-md-3 control-label text-right nomallabel">Status</label>
                                                                    <label class="col-md-8">
                                                                        <input type="radio" name="Status" id="rdlStatus" class="flat-green radio radio-inline" data-bind='iCheck: { checked: active_status}' value="A">All &nbsp;
                                                                        <input type="radio" name="Status" id="rdlStatus" checked class="flat-green radio radio-inline" data-bind='iCheck: { checked: active_status}' value="Y">Active &nbsp;
                                                                        <input type="radio" name="Status" id="rdlStatus" class="flat-green radio radio-inline" data-bind='iCheck: { checked: active_status}' value="N">Inactive
                                                                    </label>
                                                                </div>*@
                                                        </div>
                                                        <div class="text-right">
                                                            @if (Model.Member == "")
                                                            {
                                                                <button type="button" id="btnAddMem" class="btn btn-success" onclick="AddMember(objModel.IdEncrypt);">Add Member</button>
                                                            }
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="box-body">
                                                                <div class="row ">
                                                                    <div class="col-md-12">
                                                                        <div class="table-responsive">
                                                                            <table class="table table-striped table-bordered table-hover display" id="gvwDataMember" width="100%">
                                                                                <thead>
                                                                                </thead>
                                                                                <tbody></tbody>
                                                                            </table>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                            </div>
                            <div class="box-footer text-center">
                                <button type="button" class="btn btn-warning" onclick="BackPage(objModel.BackPage);">Back</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
    @*<%--[modal] before Add--%>*@
    <div id="PopupSave" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog widthPOP">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #337ab7;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="modal-title"><b style="color: white;">Saving Confirmation</b></span>
                </div>
                <div class="modal-body">
                    <div id="divCreatePopUp">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-12 text-center">Do you want to submit?</label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnOK" type="button" onclick="SaveData()" class="btn btn-primary">OK</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    @*<%--[modal] before Add--%>*@

    <div id="PopupAdd" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg  widthPOP">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #605ca8;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="modal-title"><b style="color: white;">Add Document</b></span>
                </div>
                <div class="modal-body">
                    <div id="divCreatePopUpAdd">

                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnOK" type="button" onclick="SaveDataPV()" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-default" onclick="Cancel()" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    @*<%--[modal] before Add--%>*@
    <div id="PopupEdit" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg  widthPOP">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #605ca8;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="modal-title"><b style="color: white;">Document Edit</b></span>
                </div>
                <div class="modal-body">
                    <div id="divCreatePopUpEdit">
                    </div>
                </div>
                @*<div class="modal-footer">
                        <button id="btnEditDoc" type="button" onclick="EditDocumentEMP()" class="btn btn-primary">Edit</button>
                        <button id="btnConfirm" type="button" onclick="Save()" class="btn btn-success">Confirm</button>
                        <button id="" type="button" class="btn btn-default" onclick="Cancel()" data-dismiss="modal">Cancel</button>
                    </div>*@
            </div>
        </div>
    </div>
    <div id="PopupDelete" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog widthPOP">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #337ab7;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="modal-title"><b style="color: white;">Do you want to reject?</b></span>
                </div>
                <div class="modal-body">
                    <div id="divCreatePopUp">
                        @*<div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="col-md-12 text-center">Do you want to reject?</label>
                                    </div>
                                </div>
                            </div>*@
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group form-group-sm">
                                    <label class="col-md-4 control-label text-right require">Remark</label>
                                    <div class="col-md-6">
                                        <input type="text" id="txtremark" name="txtremark" class="form-control" data-bind="value: remark_delete" />
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btnOK" type="button" onclick="DeleteData()" class="btn btn-primary">OK</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</section>

@section style{
    <link href="~/Scripts/plugins/bootstrapValidate/dist/css/bootstrapValidator.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />
    <style>

        .dt-HeadGr-ctm {
            background-color: #2952a3;
            color: rgb(255, 255, 255);
            vertical-align: middle;
        }

        .dt-total-ctm {
            background-color: #36c61a;
            color: rgb(255, 255, 255);
            vertical-align: middle;
        }

        .dt-totalAll-ctm {
            background-color: rgb(255, 222, 35);
            color: rgb(0, 0, 0);
            vertical-align: middle;
        }

        table.dataTable {
            border-collapse: collapse;
            width: 100%;
        }

        .Mass-select {
            width: 250px;
        }

        .table-responsive-custom > .dataTables_scrollBody {
            overflow-y: visible !important;
            overflow-x: visible !important;
            overflow: hidden;
        }
    </style>

}

@section scripts{
    <script src="~/Scripts/plugins/bootstrapValidate/dist/js/bootstrapValidator.js"></script>
    <script src="~/Scripts/plugins/knockout-3.4.2.js"></script>
    <script src="~/Scripts/plugins/knockout.mapping-latest.js"></script>
    <script src="~/Scripts/plugins/jquery-inputmask/min/inputmask/inputmask.min.js"></script>
    <script src="~/Scripts/plugins/jquery-inputmask/min/inputmask/inputmask.numeric.extensions.min.js"></script>
    <script src="~/Scripts/plugins/jquery-inputmask/min/inputmask/jquery.inputmask.min.js"></script>
    <script src="~/Scripts/plugins/jsLinq/linq.min.js"></script>
    <script src="~/Scripts/plugins/jsLinq/jquery.linq.min.js"></script>
    <script src="~/Scripts/plugins/DataTables2/dataTables.rowGroup.min.js"></script>
    <script src="~/Scripts/plugins/bootstrap-select/js/bootstrap-select.js"></script>
    <script src="~/Scripts/plugins/bootstrap-select/js/i18n/defaults-en_US.js"></script>

    <script type="text/javascript">
        var url = document.URL;
        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);

            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
    </script>
    <script type="text/javascript">
        var objModel = @Html.Raw(Json.Encode(Model));
        $(function () {
            SetTable();
            SetTableMember();
            BindData(objModel);
            ko.applyBindings(viewModel);
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                if (e.target.hash == '#tab_1') {

                    $('#gvwDataDoc').DataTable().columns.adjust().responsive.recalc();
                }
                else if (e.target.hash == '#tab_2') {

                    $('#gvwDataMember').DataTable().columns.adjust().responsive.recalc();
                }
            });

        });
        function Save() {
            $("#PopupSave").modal({ backdrop: 'static', keyboard: false });
        }
        function Delete() {
            $("#PopupDelete").modal({ backdrop: 'static', keyboard: false });
        }
        function GetDataforDelete() {
            var Ispass = true
            var lstData = ko.toJS(viewModel);

            //Validate varible
            debugger;
            var chk_remark = document.getElementById("txtremark").value;
            //if (chk_remark == undefined || chk_remark.length == "") {
            //    Ispass = false;
            //    DialogWarning(DialogHeader.Warning, "Please input remark.");
            //    return false;
            //}
            if (Ispass) {
                ////Document
                //lstData.Type_doc_id = document.getElementById("ddlTypeDoc").value;
                //lstData.document_number = document.getElementById("txtdoc_num").value;
                //lstData.date_of_issued = document.getElementById("txtdateIssued").value;
                //lstData.Country_id = document.getElementById("ddlCountry").value;
                //lstData.valid_date = document.getElementById("txtvaliddate").value;
                ////Employee
                ////lstData.Employee_Id = document.getElementById("txtSearch").value;
                //lstData.Employee_Id = objModel.code;
            }
            return lstData;
        }
        function GetData() {
            var Ispass = true
            var lstData = ko.toJS(viewModel);

            //Validate varible
            var chk_validate = document.getElementById("txtvaliddate").value;
            var chk_country = document.getElementById("ddlCountry").value;
            var chk_dateissued = document.getElementById("txtdateIssued").value;
            var chk_doc_num = document.getElementById("txtdoc_num").value;
            var chk_typedoc = document.getElementById("ddlTypeDoc").value;
            if (chk_typedoc == undefined || chk_typedoc.length == "") {
                Ispass = false;
                DialogWarning(DialogHeader.Warning, "Please Select Document Type.");
                return false;
            }
            //if (chk_doc_num == undefined || chk_doc_num.length == "") {
            //    Ispass = false;
            //    DialogWarning(DialogHeader.Warning, "Please Input Doucment Number.");
            //    return false;
            //}
            if (chk_dateissued == undefined || chk_dateissued.length == "") {
                Ispass = false;
                DialogWarning(DialogHeader.Warning, "Please Input Date Of Issued.");
                return false;
            }
            if (chk_country == undefined || chk_country.length == "") {
                Ispass = false;
                DialogWarning(DialogHeader.Warning, "Please Select Country.");
                return false;
            }
            if (chk_validate == undefined || chk_validate.length == "") {
                Ispass = false;
                DialogWarning(DialogHeader.Warning, "Please Input Validate.");
                return false;
            }
            if (Ispass) {
                //Document
                lstData.Type_doc_id = document.getElementById("ddlTypeDoc").value;
                lstData.document_number = document.getElementById("txtdoc_num").value;
                lstData.date_of_issued = document.getElementById("txtdateIssued").value;
                lstData.Country_id = document.getElementById("ddlCountry").value;
                lstData.valid_date = document.getElementById("txtvaliddate").value;
                //Employee
                //lstData.Employee_Id = document.getElementById("txtSearch").value;
                lstData.Employee_Id = objModel.code;
            }
            return lstData;
        }

            function DeleteData()
            {
                var IsPass = true;
                if (IsPass) {
                    $("#PopupDelete").modal("hide");
                    BlockUI();
                    var Param = GetDataforDelete();
                    debugger;
                        $.ajax({
                        dataType: AjaxCall.dataType,
                        type: AjaxCall.type,
                        contentType: AjaxCall.contentType,
                            url: '@Url.Action("DeleteEmployee", "VisaExpiry")',
                            data: JSON.stringify({ ItemData: Param }),
                        success: function (respone) {
                            if (respone.result.Status == SysProcess.SessionExpired) {

                            }
                            else if (respone.result.Status == SysProcess.Success) {
                                DialogSuccessOk(DialogHeader.Info, DialogMsg.SaveComplete, 'func', function () {
                                    BackPage(objModel.BackPage);
                            });
                        }
                        else {
                            DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                    },
                    error: AjaxCall.error,
                    complete: function (jqXHR, status) {//finaly
                        UnblockUI();
                    }
                        });
                }
                else{

                    }
            }
        function SaveDataPV(){
            var IsPass = true;
            if (IsPass) {
                BlockUI();
                var Param = GetData(); //ko.js(viewModle)
                $.ajax({
                    dataType: AjaxCall.dataType,
                    type: AjaxCall.type,
                    contentType: AjaxCall.contentType,
                    url:'@Url.Action("AddDoc_EMP", "VisaExpiry")',
                    data: JSON.stringify({ ItemData : Param }),
                    success: function (respone) {
                        debugger;
                        if (respone.result.Status == SysProcess.SessionExpired) {
                            @*PopupLogin('@Url.Action("Index", "Home")');*@
                        } else if (respone.result.Status == SysProcess.Success) {
                            DialogSuccessOk(DialogHeader.Info, DialogMsg.SaveComplete, 'func', function () {
                                location.reload();
                            });
                        }
                        else if (respone.result.Status == SysProcess.Failed && respone.result.Msg == null) {
                            //DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                        else {

                                DialogWarning(DialogHeader.Warning, respone.result.Msg);
                        }
                    },
                    error: AjaxCall.error,
                    complete: function (jqXHR, status) {//finaly
                        UnblockUI();
                    }
                });
            }
        }
        function Search() {
            var lstSearch = ko.toJS(viewModel);
            lstSearch.Customer_code = objModel.Id;
            return lstSearch;
        };
        function LoadData() {
            $('div[id$=divTable]').collapse("show");
            $('#gvwData').DataTable().columns.adjust().draw();
            var Param = Search();
            BlockUI();
            $.ajax({
                type: "POST",
                url: '@Url.Action("LoadDocument", "VisaExpiry")',
                dataType: "json",
                data: { SearchItem: Param },
                success: function (response) {
                    if (response.result.Status == SysProcess.SessionExpired) {1
                        PopupLogin('@Url.Action("Index", "Home")');
                    }
                    else {
                        debugger;
                        var lstData = response.result.lstDocEmployee;
                        if (response.result.lstDocEmployee != undefined && response.result.lstDocEmployee != null && response.result.lstDocEmployee.length != 0) {
                            $('div[id$=divTable]').collapse("show");
                            $('#gvwDataDoc').DataTable().clear().draw();
                            $('#gvwDataDoc').dataTable().fnAddData(lstData);
                            $('#gvwDataDoc').dataTable().fnDraw();
                            $('#gvwDataDoc').DataTable().columns.adjust().draw();
                        }
                        else {
                            $('div[id$=divTable]').collapse("show");
                            $('#gvwDataDoc').DataTable().clear().draw();

                            $('#gvwDataDoc').dataTable().fnDraw();
                            $('#gvwDataDoc').DataTable().columns.adjust().draw();
                        }
                    }
                },
                complete: function (jqXHR, status) {//finaly
                    $('#gvwDataDoc').DataTable().columns.adjust().draw();
                    $('#gvwDataDoc').DataTable().columns.adjust().responsive.recalc();
                    UnblockUI();
                }
            });
        }
         function LoadDataMember() {
            $('div[id$=divTable]').collapse("show");
            $('#gvwData').DataTable().columns.adjust().draw();
            var Param = Search();
            BlockUI();
            $.ajax({
                type: "POST",
                url: '@Url.Action("LoadMember", "VisaExpiry")',
                dataType: "json",
                data: { SearchItem: Param },
                success: function (response) {
                    if (response.result.Status == SysProcess.SessionExpired) {1
                        PopupLogin('@Url.Action("Index", "Home")');
                    }
                    else {
                        debugger;
                        var lstData = response.result.lstDocEmployee;
                        if (objModel.lstDocEmployee != undefined && objModel.lstDocEmployee != null && objModel.lstDocEmployee.length != 0) {
                            $('div[id$=divTable]').collapse("show");
                            $('#gvwDataDoc').DataTable().clear().draw();
                            $('#gvwDataDoc').dataTable().fnAddData(lstData);
                            $('#gvwDataDoc').dataTable().fnDraw();
                            $('#gvwDataDoc').DataTable().columns.adjust().draw();
                        }
                        else {
                            $('div[id$=divTable]').collapse("show");
                            $('#gvwDataDoc').DataTable().clear().draw();

                            $('#gvwDataDoc').dataTable().fnDraw();
                            $('#gvwDataDoc').DataTable().columns.adjust().draw();
                        }
                    }
                },
                complete: function (jqXHR, status) {//finaly
                    $('#gvwDataDoc').DataTable().columns.adjust().draw();
                    $('#gvwDataDoc').DataTable().columns.adjust().responsive.recalc();
                    UnblockUI();
                }
            });
        }
    </script>
    @*Script for bind Data KnockOut*@
    <script type="text/javascript">
        var viewModel = {

        };
        function ViewModel() {
            var self = this;
            self.conditionChecked = ko.observable(false);
            self.loadCondition = function () {
                //ajax request to get condition value. Suppose ajax request returned value "used". so
                self.conditionChecked("used");
            }
            self.loadCondition();
            ko.bindingHandlers.iCheck = { // integrating icheck plugin using bh
                init: function (element, valueAccessor) {
                    var ctrl = $(element);
                    var sID = ctrl[0].id;
                    //initialize icheck to the element
                    $(element).iCheck({
                        radioClass: 'iradio_flat-green'
                    });
                    $(element).on('ifChecked', function (event) {

                        var observable = valueAccessor();
                        observable.checked(event.target.defaultValue); //assigning selected value
                    });
                },
                update: function (element, valueAccessor) {
                    var observable = valueAccessor();
                }
            };
        }
        function BindData(value) {
            //Table Document
            if (viewModel.name == undefined) {
                viewModel = ko.mapping.fromJS(value);
                ViewModel();
                $("input[id*=rdlStatus][value=" + value.active_status + "]").iCheck('check');
            }
            else {
                ko.mapping.fromJS(value, {}, viewModel);
                $("input[id*=rdlStatus][value=" + value.active_status + "]").iCheck('check');
            }

            if (objModel.lstDocEmployee != undefined && objModel.lstDocEmployee != null && objModel.lstDocEmployee.length != 0) {
                $('#gvwDataDoc').DataTable().clear().draw();
                $('#gvwDataDoc').dataTable().fnAddData(objModel.lstDocEmployee);
                $('#gvwDataDoc').dataTable().fnDraw();

                setTimeout(function () {
                    $('#gvwDataDoc').DataTable().columns.adjust().draw();
                    $('#gvwDataDoc').DataTable().columns.adjust().responsive.recalc();
                }, 500);
            }
            else {
                $('#gvwDataDoc').DataTable().clear().draw();
                $('#gvwDataDoc').dataTable().fnDraw();
                $('div[id$=divTable]').collapse("hide");
            }
            //Table Member
            if (viewModel.name == undefined) {
                viewModel = ko.mapping.fromJS(value);
                ViewModel();
                $("input[id*=rdlStatus][value=" + value.active_status + "]").iCheck('check');
            }
            else {
                ko.mapping.fromJS(value, {}, viewModel);
                $("input[id*=rdlStatus][value=" + value.active_status + "]").iCheck('check');
            }

            if (objModel.lstMember != undefined && objModel.lstMember != null && objModel.lstMember.length != 0) {
                $('#gvwDataMember').DataTable().clear().draw();
                $('#gvwDataMember').dataTable().fnAddData(objModel.lstMember);
                $('#gvwDataMember').dataTable().fnDraw();

                setTimeout(function () {
                    $('#gvwDataMember').DataTable().columns.adjust().draw();
                    $('#gvwDataMember').DataTable().columns.adjust().responsive.recalc();
                }, 500);
            }
            else {
                $('#gvwDataMember').DataTable().clear().draw();
                $('#gvwDataMember').dataTable().fnDraw();
                $('div[id$=divTable]').collapse("hide");
            }
        }


        function AddDocument() {
            $("#PopupAdd").modal({ backdrop: 'static', keyboard: false });
             $.ajax({
                url: '@Url.Action("AddDocument", "VisaExpiry")',
                dataType: 'html',
                cache: false,
                //data: { id: value, pr: prid },
                success: function (data) {
                    $('#divCreatePopUpAdd').html(data);
                 }, complete: function (jqXHR, status) {//finaly
                    //BindDataPV(objModelPVS);
                    //ko.applyBindings(viewModelPV, document.getElementById("pvDocument"));
                    //ValidateFormPV();
                    //if (objMaxLengthCandidate != undefined) {
                    //    SetMaxLeangthJS(objMaxLengthCandidate);
                    //}
                }
            });
        }
      function EditMember(sVal) {
           
                BlockUI();
            window.location.href = '@Url.Action("EmployeeView", "VisaExpiry")?qryStr=' + sVal;
        }
          function AddMember(sVal) {
            window.location.href = '@Url.Action("MemberCreate", "VisaExpiry")?qryStr=' + sVal;
        }
        function Edit(sVal) {
            var Param = {
                IdEncrypt: sVal,
            };

            $.ajax({
                url: '@Url.Action("EditDocument", "VisaExpiry")',
                dataType: 'html',
                cache: false,
                data: Param
                , success: function (data) {

                    $('#divCreatePopUpEdit').html(data);

                 }, complete: function (jqXHR, status) {//finaly
                    //SetTableUpdate();
                    //BindDataUpdate(objModelEdit);
                    //ko.applyBindings(viewModelVisa, document.getElementById("pvDocument"));
                    //ValidateFormPV();
                    $("#PopupEdit").modal({ backdrop: 'static', keyboard: false });
                    //ValidateFormUpd();
                    //$("#PopupEdit").modal({ backdrop: 'static', keyboard: false });
                }
            });
        }


        //function for validate form
        var viewModelVisa = {

        };

        function BindDataUpdate(value2) {
            if (viewModelVisa.id == undefined) {
                viewModelVisa = ko.mapping.fromJS(value2);
            }
            else {
                ko.mapping.fromJS(value2, {}, viewModelVisa);
            }
        }
        function BackPage(sVal) {
            var sUrlBack = '@Url.Action("EmployeeList", "VisaExpiry")';
            window.location.href = sUrlBack;
        }
         function BackPageEMP(sVal) {
            var sUrlBack = '@Url.Action("EmployeeView", "VisaExpiry")?qryStr=' + sVal;
            window.location.href = sUrlBack;
        }
        function Cancel() {
            $("#PopupAdd").modal('hide');
        }
        function SetTable() {
            var objHeadClRequest = [
                { "title": "Edit", "width": "5%", "className": "dt-center-ctm", "searchable": false, "orderable": false, "data": "Edit" },
                { "title": "Document Number", "width": "15%", "className": "dt-center-ctm", "data": "document_number" },
                { "title": "Document Type", "width": "12%", "className": "dt-center-ctm", "data": "Type_doc_id" },
                { "title": "Date Of Issued", "width": "12%", "className": "dt-center-ctm", "data": "date_of_issued" },
                { "title": "Nationality", "width": "12%", "className": "dt-center-ctm", "data": "Country_id" },
                { "title": "Valid Date", "width": "15%", "className": "dt-center-ctm", "data": "valid_date" },
                { "title": "Status", "width": "10%", "className": "dt-center-ctm", "data": "active_status" },
                { "title": "Created Date", "width": "10%", "className": "dt-center-ctm", "data": "create_date" },
                { "title": "Update Date", "width": "16%", "className": "dt-center-ctm", "data": "update_date" },
                //{ "title": "Staff KPMG", "width": "10%", "className": "dt-center-ctm", "data": "Staff_id" },
            ];

            var objTableRe = {
                sTableID: "gvwDataDoc",
                nDis: [],
                sProperty: "<'top col-md-6'>rt<'bottom col-md-6'><'bottom col-md-6 text-right'><'clear'>",
                objHeadCl: objHeadClRequest,//Table Headder
                objDataSet: [], //dataset
                nHeadFix: 0,// fix clr
                EmptyTable: EmptyTable,
                order: [[1, "asc"]],
                objBeforeClRender: false,
                lengthMN: [[-1], ["All"]],
            };
            var table = CreatTableJS(objTableRe);

        }

        function SetTableMember() {
            var objHeadClRequest = [
                { "title": "Edit", "width": "5%", "className": "dt-center-ctm", "searchable": false, "orderable": false, "data": "EditMember" },
                /*{ "title": "Employee Id", "width": "15%", "className": "dt-center-ctm", "data": "code" },*/
                { "title": "Prefix", "width": "10%", "className": "dt-center-ctm", "data": "TM_Prefix_Id" },
                { "title": "Full Name", "width": "15%", "className": "dt-center-ctm", "data": "full_name" },
                { "title": "Email", "width": "15%", "className": "dt-center-ctm", "data": "mail" },
                { "title": "Status", "width": "10%", "className": "dt-center-ctm", "data": "active_status" },
                { "title": "Created Date", "width": "10%", "className": "dt-center-ctm", "data": "create_date" },
                { "title": "Update Date", "width": "10%", "className": "dt-center-ctm", "data": "update_date" },
                //{ "title": "Staff KPMG", "width": "10%", "className": "dt-center-ctm", "data": "Staff_id" },
            ];

            var objTableRe = {
                sTableID: "gvwDataMember",
                nDis: [],
                sProperty: "<'top col-md-6'>rt<'bottom col-md-6'><'bottom col-md-6 text-right'><'clear'>",
                objHeadCl: objHeadClRequest,//Table Headder
                objDataSet: [], //dataset
                nHeadFix: 0,// fix clr
                EmptyTable: EmptyTable,
                order: [[1, "asc"]],
                objBeforeClRender: false,
                lengthMN: [[-1], ["All"]],
            };
            var table = CreatTableJS(objTableRe);

        }
        function EditEmp(sVal) {
            window.location.href = '@Url.Action("EmployeeEdit", "VisaExpiry")?qryStr=' + sVal;
        }
    </script>


}
